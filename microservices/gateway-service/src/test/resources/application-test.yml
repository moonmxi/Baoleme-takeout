# 测试环境配置文件
# 用于网关服务的集成测试

spring:
  application:
    name: gateway-service-test
  
  # 数据库配置（使用H2内存数据库进行测试）
  datasource:
    url: jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
    username: sa
    password: 
    driver-class-name: org.h2.Driver
    
    # 多数据源配置（测试环境使用相同的H2数据库）
    user:
      jdbc-url: jdbc:h2:mem:testdb_user;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
      username: sa
      password: 
      driver-class-name: org.h2.Driver
      hikari:
        pool-name: TestUserHikariPool
        maximum-pool-size: 5
        minimum-idle: 1
    
    merchant:
      jdbc-url: jdbc:h2:mem:testdb_merchant;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
      username: sa
      password: 
      driver-class-name: org.h2.Driver
      hikari:
        pool-name: TestMerchantHikariPool
        maximum-pool-size: 5
        minimum-idle: 1
    
    rider:
      jdbc-url: jdbc:h2:mem:testdb_rider;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
      username: sa
      password: 
      driver-class-name: org.h2.Driver
      hikari:
        pool-name: TestRiderHikariPool
        maximum-pool-size: 5
        minimum-idle: 1
    
    admin:
      jdbc-url: jdbc:h2:mem:testdb_admin;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
      username: sa
      password: 
      driver-class-name: org.h2.Driver
      hikari:
        pool-name: TestAdminHikariPool
        maximum-pool-size: 5
        minimum-idle: 1
  
  # H2数据库控制台（仅测试环境）
  h2:
    console:
      enabled: true
      path: /h2-console
  
  # JPA配置
  jpa:
    hibernate:
      ddl-auto: create-drop
    show-sql: true
    properties:
      hibernate:
        format_sql: true
        dialect: org.hibernate.dialect.H2Dialect

# 服务器配置
server:
  port: 0  # 随机端口，避免测试冲突

# 日志配置
logging:
  level:
    org.demo.gateway: debug
    org.springframework.web: debug
    org.springframework.security: debug
    org.springframework.jdbc: debug
    com.zaxxer.hikari: info
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"

# 自定义配置
gateway:
  database:
    timeout: 10000
    batch-size: 100
    enable-transaction: true
    pool-monitoring: false
  
  # 安全认证配置（测试环境）
  security:
    enabled: true
    secret-key: "test-secret-key-2025"
    token-expiry: 60  # 测试环境令牌有效期1分钟
  
  # 表到数据源的映射配置
  table-mapping:
    user: user
    merchant: merchant
    store: merchant
    product: merchant
    sales: merchant
    rider: rider
    admin: admin
    order: gateway
    order_item: gateway
    review: gateway
    cart: gateway
    coupon: gateway
    message: gateway
    favorite: user
    browse_history: user

# 测试专用配置
test:
  data:
    # 是否初始化测试数据
    initialize: true
    # 测试数据文件路径
    sql-script: classpath:test-data.sql
  
  security:
    # 测试用的服务名称
    test-service-name: "test-service"
    # 测试用的操作类型
    test-operation: "database-operation"
  
  database:
    # 测试超时时间（毫秒）
    timeout: 5000
    # 最大重试次数
    max-retries: 3